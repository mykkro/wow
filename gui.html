<!DOCTYPE html>
<html>
<head>
  <link href="css/normalize.css" media="all" rel="stylesheet" type="text/css" />
  <link href="css/style.css" media="all" rel="stylesheet" type="text/css" />
  <link href="fonts/SourceSanspro/fontface.css" media="all" rel="stylesheet" type="text/css" />
  <!-- third party libraries should be loaded here and then passed to the Widgetizer module... -->
  <script type="text/javascript" src="js/jquery/jquery-2.0.3.min.js"></script>
  <script type="text/javascript" src="js/svgjs/svg.min.js"></script>
  <script type="text/javascript" src="js/svgjs/svg.easing.min.js"></script>
  <script type="text/javascript" src="js/svgjs/svg.filter.js"></script>
	<script>
	var DEBUG = true
	$(document).ready(function() {
	
		var mustache = require('mustache');
		var url = require('url')
		var path = require('path')

		/* loads page view and script */
		function loadPage(pageInfo, data, next) {
			var scriptName = pageInfo.script || pageInfo.view
			var pageName = pageInfo.view
			var allData = $.extend(data, pageInfo)
		   $.get("pages/"+pageName+".wow").done(function(response) {				
				var html = mustache.to_html(response, allData);
				$('#top-wrapper').html(html);
				var scr = require("./pages/"+scriptName+".js")(window, $, SVG)
				scr.init(allData, next)
			}).fail(function(err) {
				alert("Error loading view: "+pageName)
			})
		}
				
		/* creates link to a page */
		function getPageUrl(pageInfo) {
			// assemble URL
			return url.format({
				protocol:parsedUrl.protocol, 
				pathname:parsedUrl.pathname, 
				query: pageInfo.query, 
				hash: pageInfo.hash
			})
		}	
		
		var loc = window.location.href
		var parsedUrl = url.parse(loc, true)
		var query = parsedUrl.query
		var hash = parsedUrl.hash

		/* raw URL data */
		var pageInfo = {
			view: query.view || "homepage",
			script: query.view || "homepage",
			query: query,
			hash: hash
		}

		console.log(getPageUrl(pageInfo))

		var previews = ["BookCategoriesPage", "BooksPage", "ButtonsPage", "HomePage", "LoginPage", "RadioPage", "VideoPage", "YouTubePage"]		
		/* Custom page data - eg. loaded from database */
		var pageData = {
		}

		/* Do it! */
		loadPage(pageInfo, pageData, function(ctrl) {
			console.log("Page loaded successfully!")
			console.log(pageData)
		})
		
					
	})
	</script>
</head>
<body>
<div id="top-wrapper"></div>
</body>
</html>
