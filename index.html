<!DOCTYPE html>
<html>
<head>
  <link href="css/normalize.css" media="all" rel="stylesheet" type="text/css" />
  <link href="css/style.css" media="all" rel="stylesheet" type="text/css" />

  <link rel="stylesheet/less" href="css/style.less" type="text/css" /> 

  <link href="fonts/SourceSansPro/fontface.css" media="all" rel="stylesheet" type="text/css" />
  <link href="fonts/Meteocons/stylesheet.css" media="all" rel="stylesheet" type="text/css" />
  <!-- third party libraries should be loaded here and then passed to the Widgetizer module... -->
  <script type="text/javascript" src="js/less/less-1.6.1.min.js"></script>
  <script type="text/javascript" src="js/jquery/jquery-2.0.3.min.js"></script>
  <script type="text/javascript" src="js/jquery.history/jquery.history.min.js"></script>
  <script type="text/javascript" src="js/jquery.svg/jquery.svg.min.js"></script>
  <script type="text/javascript" src="js/jquery.svg/jquery.svgdom.min.js"></script>
  <script type="text/javascript" src="js/svgjs/svg.min.js"></script>
  <script type="text/javascript" src="js/svgjs/svg.easing.min.js"></script>
  <script type="text/javascript" src="js/svgjs/svg.filter.js"></script>
  <script>
  var DEBUG = true
  
  // access main module...
  //process.mainModule.exports.hello()


    var i18n = new (require('i18n-2'))({
        locales: ['en', 'de', 'cz'],
        defaultLocale: 'en'
    });

    i18n.setLocale('de')

    var PageLoader = require("./lib/pageloader")(window, $, SVG, i18n)

  $(document).ready(function() {
  
    var url = require('url')
    var path = require('path')
    var gui = require('nw.gui');
    var loc = window.location.href
    var parsedUrl = url.parse(loc, true)
    var query = parsedUrl.query
    var hash = parsedUrl.hash

    window.gui = gui

    /* raw URL data */
    var pageInfo = {
      view: query.view || "loginpage",
      script: query.view || "loginpage",
      query: query,
      hash: hash,
      baseUrl: url.format({
        protocol:parsedUrl.protocol, 
        pathname:parsedUrl.pathname
      })
    }

    /* Custom page data - eg. loaded from database */
    var pageData = {
    }


    var Auth = require("./lib/auth")(window)
    Auth.login("mykkro", "pass", function(err, user) {
      if(err) console.error(err)
      if(user) console.log(user)
    })

    /* Do it! */
    PageLoader.loadPage(pageInfo, pageData, function(ctrl) {
      console.log("Page loaded successfully!")
      console.log(pageData)
      
      // FIX to prevent backspace key from doing "go back to previous page"
      // from: http://stackoverflow.com/questions/1495219/how-can-i-prevent-the-backspace-key-from-navigating-back
      
      /*
       * this swallows backspace keys on any non-input element.
       * stops backspace -> back
       */
      var rx = /INPUT|SELECT|TEXTAREA/i;

      $(window.document).bind("keydown keypress", function(e){
        if( e.which == 8 ){ // 8 == backspace
          if(!rx.test(e.target.tagName) || e.target.disabled || e.target.readOnly ){
            e.preventDefault();
          }
        }
      });
      
    })
    
          
  })
  </script>
</head>
<body>
<div id="top-wrapper"></div>
<div id="iframe-wrapper"></div>
</body>
</html>
