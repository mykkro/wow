<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title></title>

	<link rel="stylesheet" type="text/css" href="css/bundle.css" />    
	<link rel="stylesheet" type="text/css" href="css/style.css" />    
	<script src="js/bundle.js" type="text/javascript"></script>
	<script src="js/app.js" type="text/javascript"></script>
	<script>

function getParameterByName(name) {
    name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
    var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
        results = regex.exec(location.search);
    return results == null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
}

	$(function() {
    var locale = getParameterByName('lang') || 'en'
    var localeUrl = "lang/"+locale+".json"
    var metadataUrl = "wow.json"


    $.when($.getJSON(metadataUrl), $.getJSON(localeUrl), $.get("templates/view.html")).done(function(d1, d2, d3) {

      var metadata = d1[0]
      var localedata = d2[0]
      var viewTpl = d3[0]

    $("head title").text(metadata.title)
    $("body").append(Mustache.render(viewTpl, {wow:metadata, translated:localedata}))

      /* localization function... */
      window.__ = function(str) {
        return localedata.labels[str] || str
      }

      var MyClass = window[metadata.className]
      var game = new MyClass()
      var gui = new GameUI(game)    

      console.log("Ready!")
      gui.init()

  $("#tab-settings .game-settings").alpaca({
    "schema": {
      "title": __("Settings"),
      "description": __("Game Settings"),
      "type": "object",
      "properties": {
        "difficulty": {
          "type": "string",
          "required": true,
          "default": "easy",
          "enum": ['easy', 'medium', 'hard']
        }
      }
    },
    "options": {
            "renderForm": true,
            "form": {
                "buttons": {
                    "submit": {}
                }
            },
            "fields": {
                "difficulty": {
                    "label": __("Difficulty"),
                    "type": "select",
                    "optionLabels": [__("Easy"), __("Medium"), __("Hard")]
                }
            }
        }
  });

    })
  })
	</script>

  </head>
  <body>
  	
  </body>
</html>